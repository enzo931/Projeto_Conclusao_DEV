<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrinho de Compras</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="src/css/carrinhopg/style.css">
</head>

<body>
  <!-- Top Bar -->
  <header class="topbar">
    <div class="menu-icon" id="openSidebar"><i class="fa fa-bars"></i></div>
    <div class="logo">
      <a href="index.html"><img src="src/imgs/logo/image.png" alt="Logo"></a>
    </div>
    <div class="search-bar">
      <input type="text" placeholder="Buscar produtos...">
      <button><i class="fa fa-search"></i></button>
    </div>
    <div class="icons">
      <a href="Login.html"><i class="fa fa-user"></i></a>
      <i class="fa fa-cog"></i>
      <a href="carrinho.html"><i class="fa fa-shopping-cart"></i></a>
    </div>
  </header>

  <!-- Sidebar (oculta por padrão) -->
  <aside class="sidebar" id="sidebar">
    <button class="close-btn" id="closeSidebar"><i class="fa fa-times"></i></button>
    <div class="sidebar-logo">
      <img src="src/imgs/logo/image.png" alt="Epic Hardware" width="150">
    </div>
    <h3>Categorias</h3>
    <ul>
      <li><i class="fa fa-desktop"></i> Computadores</li>
      <li><i class="fa fa-tv"></i> Monitores</li>
      <li><i class="fa fa-recycle"></i> Produtos Reutilizados</li>
      <li><i class="fa fa-microchip"></i> Hardware</li>
      <li><i class="fa fa-keyboard"></i> Periféricos</li>
      <li><i class="fa fa-certificate"></i> Produtos Certificados</li>
    </ul>
    <h3>Ajuda</h3>
    <ul>
      <li><i class="fa fa-user-circle"></i> Seu perfil</li>
      <li><i class="fa fa-headset"></i> Suporte</li>
      <li><i class="fa fa-wrench"></i> Configurações</li>
    </ul>
  </aside>

  <!-- Overlay -->
  <div id="overlay" class="overlay"></div>

  <section class="cart">
    <h2>SEU CARRINHO</h2>
    <div id="cart-items"></div>
    <div class="cart-actions" style="margin-top:30px;">
      <button class="clear-cart">LIMPAR CARRINHO</button>
      <button class="finalize-order">FINALIZAR PEDIDO</button>
    </div>
  </section>
</body>
<script>
  (() => {
    // elementos (tenta vários nomes/seletores possíveis)
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const openBtn = document.getElementById('openSidebar')   // usado antes nos exemplos
      || document.getElementById('menu-btn')    // alternativa do meu snippet
      || document.querySelector('.menu-icon');  // caso só tenha classe
    const closeBtn = document.getElementById('closeSidebar')
      || (sidebar && sidebar.querySelector('.close-btn'));

    // helpers
    const isEl = el => el !== null && el !== undefined;

    function openMenu() {
      if (isEl(sidebar)) sidebar.classList.add('active');
      if (isEl(overlay)) overlay.classList.add('active');
    }

    function closeMenu() {
      if (isEl(sidebar)) sidebar.classList.remove('active');
      if (isEl(overlay)) overlay.classList.remove('active');
    }

    function toggleMenu() {
      if (isEl(sidebar)) sidebar.classList.toggle('active');
      if (isEl(overlay)) overlay.classList.toggle('active');
    }

    // liga os eventos (só se os elementos existirem)
    if (isEl(openBtn)) {
      openBtn.addEventListener('click', (e) => {
        // se quiser comportamento toggle: toggleMenu();
        openMenu();
      });
    } else {
      console.warn('Botão de abrir menu não encontrado (procure por id="openSidebar" ou id="menu-btn" ou class="menu-icon").');
    }

    if (isEl(closeBtn)) {
      closeBtn.addEventListener('click', closeMenu);
    }

    if (isEl(overlay)) {
      overlay.addEventListener('click', closeMenu);
    }

    // fechar com ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeMenu();
    });

    // sanity check no console para ajudar debug
    console.log('Sidebar:', !!sidebar, 'Overlay:', !!overlay, 'OpenBtn:', !!openBtn, 'CloseBtn:', !!closeBtn);
  })();

  document.addEventListener("DOMContentLoaded", function () {
    const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
    if (!usuario) {
      window.location.href = "Login.html";
      return;
    }

    // Array de produtos (igual ao seu)
    const produtos = [
      {
        id: 1,
        nome: "Placa de Vídeo RX 560 XT",
        preco: 1500,
        descricao: "Placa de vídeo Radeon RX 560 XT, 8GB GDDR5, excelente para jogos em Full HD.",
        imagem: "src/imgs/produtos/placa de video.jpg"
      },
      {
        id: 2,
        nome: "Processador Ryzen 5 4500",
        preco: 950,
        descricao: "Processador AMD Ryzen 5 4500, 6 núcleos, 12 threads, até 4.1GHz, ideal para multitarefas.",
        imagem: "src/imgs/produtos/ryzen5.jpg"
      },
      {
        id: 3,
        nome: "Memória RAM 16GB DDR4 3200MHz",
        preco: 420,
        descricao: "Kit 2x8GB DDR4 3200MHz, alto desempenho para jogos e produtividade.",
        imagem: "src/imgs/produtos/Memoria Ram kllisre.webp"
      },
      {
        id: 4,
        nome: "Placa-mãe ASUS TUF B450M",
        preco: 550,
        descricao: "Placa-mãe ASUS TUF B450M, compatível com processadores Ryzen, robusta e durável.",
        imagem: "src/imgs/produtos/Placa-mãe ASUS TUF B450M.jpg"
      },
      {
        id: 5,
        nome: "Fonte Corsair CV550 80 Plus Bronze",
        preco: 300,
        descricao: "Fonte Corsair CV550 de 550W, certificação 80 Plus Bronze, ideal para PCs intermediários.",
        imagem: "src/imgs/produtos/Fonte Corsair CV550 80 Plus Bronze.jpg"
      },
      {
        id: 6,
        nome: "SSD Kingston A2000 500GB",
        preco: 400,
        descricao: "SSD Kingston A2000 NVMe 500GB, velocidade de leitura até 2200MB/s, perfeito para boot rápido.",
        imagem: "src/imgs/produtos/SSD Kingston A2000 500GB.jpg"
      },
      {
        id: 7,
        nome: "HD Seagate Barracuda 1TB",
        preco: 250,
        descricao: "HD Seagate Barracuda 1TB, 7200 RPM, confiável e com grande capacidade de armazenamento.",
        imagem: "src/imgs/produtos/HD Seagate Barracuda 1TB.jpg"
      },
      {
        id: 8,
        nome: "Cooler Master Hyper 212 EVO",
        preco: 180,
        descricao: "Cooler Master Hyper 212 EVO, sistema de refrigeração para processadores com excelente custo-benefício.",
        imagem: "src/imgs/produtos/Cooler Master Hyper 212 EVO.jpg"
      },
      {
        id: 9,
        nome: "Gabinete NZXT H510",
        preco: 450,
        descricao: "Gabinete NZXT H510, design clean e excelente gerenciamento de cabos, ideal para setups modernos.",
        imagem: "src/imgs/produtos/Gabinete NZXT H510.jpg"
      },
      {
        id: 10,
        nome: "Teclado Mecânico Redragon K552",
        preco: 250,
        descricao: "Teclado mecânico Redragon K552 com switches Outemu Red, retroiluminação RGB e alta durabilidade.",
        imagem: "src/imgs/produtos/Teclado Mecânico Redragon K552.jpg"
      },
      {
        id: 11,
        nome: "Mouse Gamer Logitech G203",
        preco: 130,
        descricao: "Mouse gamer Logitech G203, 8000 DPI, ideal para jogos rápidos e de precisão.",
        imagem: "src/imgs/produtos/mouse logitech.jpg"
      },
      {
        id: 12,
        nome: "Monitor LED 24\" AOC 75Hz",
        preco: 600,
        descricao: "Monitor AOC de 24 polegadas, resolução Full HD e taxa de atualização de 75Hz.",
        imagem: "src/imgs/produtos/monitor aoc.jpg"
      },
      {
        id: 13,
        nome: "Headset Razer Kraken X",
        preco: 350,
        descricao: "Headset Razer Kraken X, som imersivo e microfone ajustável para comunicação clara.",
        imagem: "src/imgs/produtos/headset razer.jpg"
      },
      {
        id: 14,
        nome: "Placa de Áudio Creative Sound Blaster Z",
        preco: 450,
        descricao: "Placa de áudio Creative Sound Blaster Z, som de alta qualidade para gamers e profissionais.",
        imagem: "src/imgs/produtos/placa de audio.jpg"
      },
      {
        id: 15,
        nome: "Webcam Logitech C920",
        preco: 400,
        descricao: "Webcam Logitech C920, Full HD 1080p, ideal para streaming e videochamadas.",
        imagem: "src/imgs/produtos/webcam logitech.jpg"
      },
      {
        id: 16,
        nome: "Leitor de Cartão SD Kingston 35MB/s",
        preco: 80,
        descricao: "Leitor de cartão SD Kingston, velocidade de leitura até 35MB/s, compacto e eficiente.",
        imagem: "src/imgs/produtos/leitor de cartao.jpg"
      },
      {
        id: 17,
        nome: "Hub USB 3.0 4 Portas Anker",
        preco: 100,
        descricao: "Hub USB 3.0 Anker com 4 portas, compacto e ideal para expandir as conexões do seu PC.",
        imagem: "src/imgs/produtos/hub usb.jpg"
      },
      {
        id: 18,
        nome: "Controlador de Jogos Xbox One",
        preco: 350,
        descricao: "Controle Xbox One, compatível com PC e consoles, design ergonômico e excelente para jogos.",
        imagem: "src/imgs/produtos/controlador xbox.jpg"
      },
      {
        id: 19,
        nome: "Placa de Captura Elgato HD60 S",
        preco: 1300,
        descricao: "Placa de captura Elgato HD60 S, captura de vídeo em Full HD a 60fps, ideal para streamers.",
        imagem: "src/imgs/produtos/placa de captura.jpg"
      },
      {
        id: 20,
        nome: "Roteador TP-Link Archer C6",
        preco: 250,
        descricao: "Roteador TP-Link Archer C6, Wi-Fi AC1200, ideal para conexões estáveis e rápidas em sua casa.",
        imagem: "src/imgs/produtos/roteador tplink.jpg"
      },
      {
        id: 21,
        nome: "Memória RAM Corsair Vengeance 32GB",
        preco: 850,
        descricao: "Memória RAM Corsair Vengeance 32GB, DDR4, ideal para tarefas pesadas e multitarefa.",
        imagem: "src/imgs/produtos/ram corsair.jpg"
      },
      {
        id: 22,
        nome: "Placa de Vídeo GeForce GTX 1660",
        preco: 2500,
        descricao: "Placa de vídeo GeForce GTX 1660, 6GB GDDR5, excelente para jogos em 1080p.",
        imagem: "src/imgs/produtos/placa de video gtx.jpg"
      },
      {
        id: 23,
        nome: "Processador Intel Core i7-10700K",
        preco: 2300,
        descricao: "Processador Intel Core i7-10700K, 8 núcleos, 16 threads, até 5.1GHz, ideal para overclocking.",
        imagem: "src/imgs/produtos/processador i7.jpg"
      }
    ]; // Cole aqui o array de produtos

    // Carrinho agora pode ser [{id: X, quantidade: Y}, ...]
    // Se for array de ids, converte para array de objetos
    if (usuario.carrinho && typeof usuario.carrinho[0] === "number") {
      usuario.carrinho = usuario.carrinho.map(id => ({ id, quantidade: 1 }));
      localStorage.setItem("usuarioLogado", JSON.stringify(usuario));
    }

    function salvarCarrinho() {
      localStorage.setItem("usuarioLogado", JSON.stringify(usuario));
      fetch(`http://localhost:3000/usuarios/${usuario.id}/carrinho`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ carrinho: usuario.carrinho })
      });
    }

    function renderCarrinho() {
      const cartItems = document.getElementById("cart-items");
      cartItems.innerHTML = "";

      if (!usuario.carrinho || usuario.carrinho.length === 0) {
        cartItems.innerHTML = "<p>Seu carrinho está vazio.</p>";
        return;
      }

      usuario.carrinho.forEach((item, idx) => {
        const produto = produtos.find(p => p.id === item.id);
        if (!produto) return;
        const div = document.createElement("div");
        div.className = "cart-item";
        div.innerHTML = `
          <div class="product-info">
            <img src="${produto.imagem}" alt="${produto.nome}">
            <div class="details">
              <h3>${produto.nome}</h3>
              <p>${produto.descricao}</p>
              <span>Marca: ${produto.marca || "N/A"}</span>
            </div>
          </div>
          <div class="price">
            <span class="price-value">R$ ${(produto.preco * item.quantidade).toFixed(2)}</span>
            <span class="discount">15% de desconto no PIX</span>
            <span class="installments">Em até 12x de R$ ${((produto.preco * item.quantidade) / 12).toFixed(2)} sem juros no cartão</span>
          </div>
          <div class="quantity">
            <button class="menos" data-idx="${idx}">-</button>
            <input type="number" min="1" value="${item.quantidade}" data-idx="${idx}">
            <button class="mais" data-idx="${idx}">+</button>
          </div>
        `;
        cartItems.appendChild(div);
      });

      // Eventos de quantidade
      cartItems.querySelectorAll(".menos").forEach(btn => {
        btn.addEventListener("click", function () {
          const idx = +this.dataset.idx;
          if (usuario.carrinho[idx].quantidade > 1) {
            usuario.carrinho[idx].quantidade--;
            salvarCarrinho();
            renderCarrinho();
          }
        });
      });
      cartItems.querySelectorAll(".mais").forEach(btn => {
        btn.addEventListener("click", function () {
          const idx = +this.dataset.idx;
          usuario.carrinho[idx].quantidade++;
          salvarCarrinho();
          renderCarrinho();
        });
      });
      cartItems.querySelectorAll("input[type=number]").forEach(input => {
        input.addEventListener("change", function () {
          const idx = +this.dataset.idx;
          let val = parseInt(this.value);
          if (isNaN(val) || val < 1) val = 1;
          usuario.carrinho[idx].quantidade = val;
          salvarCarrinho();
          renderCarrinho();
        });
      });
    }

    renderCarrinho();

    // Limpar carrinho
    document.querySelector(".clear-cart").addEventListener("click", function () {
      usuario.carrinho = [];
      salvarCarrinho();
      renderCarrinho();
    });

    // Finalizar pedido
    document.querySelector(".finalize-order").addEventListener("click", function () {
      if (!usuario.carrinho || usuario.carrinho.length === 0) {
        alert("Seu carrinho está vazio!");
        return;
      }
      alert("Pedido finalizado! Obrigado por comprar na Epic Hardware.");
      usuario.carrinho = [];
      salvarCarrinho();
      renderCarrinho();
    });
  });

  // Adapta o ícone/nome do usuário na topbar e o redirecionamento
  document.addEventListener("DOMContentLoaded", function () {
    const usuarioLogado = JSON.parse(localStorage.getItem("usuarioLogado"));
    const userLink = document.querySelector(".icons a");
    if (!userLink) return;

    // Troca ícone pelo nome se logado
    if (usuarioLogado) {
      userLink.innerHTML = `<span class="user-nome">${usuarioLogado.nome.split(" ")[0]}</span>`;
      userLink.addEventListener("click", function (e) {
        e.preventDefault();
        window.location.href = "usuario.html";
      });
    } else {
      userLink.innerHTML = `<i class="fa fa-user"></i>`;
      // (opcional: pode deixar o link para Login.html)
    }
  });
</script>

</html>